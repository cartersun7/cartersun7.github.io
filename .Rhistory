domain = #nfo_pop_2010_2020$absolute_pop
c(-84,80)
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~round(absolute_pop),
color = "white",
opacity = 0.75,
fillOpacity = 1,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~round(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
knitr::opts_chunk$set(include = FALSE)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~round(absolute_pop),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~round(absolute_pop) + "people per acre",
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
knitr::opts_chunk$set(echo = TRUE)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="ae50ac1baf05a1c9f156a1c83c62722ac7838e04")
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
blocks_2020 <-
blocks(
"CA", "San Mateo", year = 2020, progress_bar = F
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="ae50ac1baf05a1c9f156a1c83c62722ac7838e04")
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
blocks_2020 <-
blocks(
"CA", "San Mateo", year = 2020, progress_bar = F
)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P001001
)
blocks_2010 <-
blocks(
"CA", "San Mateo", year = 2010, progress_bar = F
)
nfo_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "North Fair Oaks")
nfo_blocks_2010 <- blocks_2010 %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
st_drop_geometry() %>%
left_join(blocks_2010 %>% select(GEOID10)) %>%
st_as_sf() %>%
select(block = GEOID10) %>%
left_join(smc_pop_2010)
nfo_blocks_2020 <- blocks_2020 %>%
.[nfo_boundary, ] %>%
select(block = GEOID20) %>%
left_join(smc_pop_2020)
nfo_blocks_2020_intersect <-
nfo_blocks_2020 %>%
st_transform(26910) %>%
mutate(original_area = st_area(.)) %>%
st_intersection(
nfo_blocks_2010 %>%
select(block) %>%
st_transform(26910)
) %>%
mutate(
leftover_area = st_area(.),
perc_area = as.numeric(leftover_area/original_area),
pop_2020 = pop * perc_area
)
nfo_blocks_2020_reshaped <-
nfo_blocks_2020_intersect %>%
st_drop_geometry() %>%
group_by(block) %>%
summarize(
pop_2020 = sum(pop_2020, na.rm=T) %>% round()
)
projection <- "+proj=longlat +zone=10 +ellps=GRS80  +datum=WGS84 +units=ft +no_defs"
#+datum=NAD83 +proj=utm
nfo_pop_2010_2020 <- nfo_blocks_2010 %>%
# st_drop_geometry() %>%
left_join(nfo_blocks_2020_reshaped) %>%
#  st_as_sf() %>%
mutate(
absolute_pop = (pop_2020 - pop)/ as.numeric(st_area(.)) * 43560
)
max <- max(abs(5))
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = c(-84,80)
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
projection <- "+proj=longlat +zone=10 +ellps=GRS80  +datum=WGS84 +units=ft +no_defs"
#+datum=NAD83 +proj=utm
nfo_pop_2010_2020 <- nfo_blocks_2010 %>%
# st_drop_geometry() %>%
left_join(nfo_blocks_2020_reshaped) %>%
#  st_as_sf() %>%
mutate(
absolute_pop = (pop_2020 - pop)/ as.numeric(st_area(.)) * 43560
)
max <- max(abs(5))
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = c(-84,80)
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-84,80),
title = "Absolute Change <br> in Density"
)
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = nfo_pop_2010_2020$absolute_pop
#c(-84,80)
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = nfo_pop_2010_2020$absolute_pop,
title = "Absolute Change <br> in Density"
)
View(nfo_pop_2010_2020)
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = c(-500,500)
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-500,500),
title = "Absolute Change <br> in Density"
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="ae50ac1baf05a1c9f156a1c83c62722ac7838e04")
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
blocks_2020 <-
blocks(
"CA", "San Mateo", year = 2020, progress_bar = F
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(mapview)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="ae50ac1baf05a1c9f156a1c83c62722ac7838e04")
dec_vars_2020 <-
listCensusMetadata(
name = "2020/dec/pl",
type = "variables"
)
smc_pop_2020 <-
getCensus(
name = "dec/pl",
vintage = 2020,
region = "block:*",
regionin = "state:06+county:081",
vars = "P1_001N"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P1_001N
)
blocks_2020 <-
blocks(
"CA", "San Mateo", year = 2020, progress_bar = F
)
dec_vars_2010 <-
listCensusMetadata(
name = "2010/dec/pl",
type = "variables"
)
smc_pop_2010 <-
getCensus(
name = "dec/pl",
vintage = 2010,
region = "block:*",
regionin = "state:06+county:081",
vars = "P001001"
) %>%
transmute(
block =
paste0(state,county,tract,block),
pop = P001001
)
blocks_2010 <-
blocks(
"CA", "San Mateo", year = 2010, progress_bar = F
)
nfo_boundary <- places("CA", progress_bar = F) %>%
filter(NAME == "North Fair Oaks")
nfo_blocks_2010 <- blocks_2010 %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
st_drop_geometry() %>%
left_join(blocks_2010 %>% select(GEOID10)) %>%
st_as_sf() %>%
select(block = GEOID10) %>%
left_join(smc_pop_2010)
nfo_blocks_2020 <- blocks_2020 %>%
.[nfo_boundary, ] %>%
select(block = GEOID20) %>%
left_join(smc_pop_2020)
nfo_blocks_2020_intersect <-
nfo_blocks_2020 %>%
st_transform(26910) %>%
mutate(original_area = st_area(.)) %>%
st_intersection(
nfo_blocks_2010 %>%
select(block) %>%
st_transform(26910)
) %>%
mutate(
leftover_area = st_area(.),
perc_area = as.numeric(leftover_area/original_area),
pop_2020 = pop * perc_area
)
nfo_blocks_2020_reshaped <-
nfo_blocks_2020_intersect %>%
st_drop_geometry() %>%
group_by(block) %>%
summarize(
pop_2020 = sum(pop_2020, na.rm=T) %>% round()
)
projection <- "+proj=longlat +zone=10 +ellps=GRS80  +datum=WGS84 +units=ft +no_defs"
#+datum=NAD83 +proj=utm
nfo_pop_2010_2020 <- nfo_blocks_2010 %>%
# st_drop_geometry() %>%
left_join(nfo_blocks_2020_reshaped) %>%
#  st_as_sf() %>%
mutate(
absolute_pop = (pop_2020 - pop)/ as.numeric(st_area(.)) * 43560
)
absolute_pal <- colorNumeric(
palette = "PiYG",
domain = c(-500,600)
)
leaflet(nfo_pop_2010_2020) %>%
addProviderTiles(provider = providers$CartoDB.Positron) %>%
addPolygons(
fillColor = ~absolute_pal(absolute_pop),
label = ~paste0(
round(absolute_pop),
" people per acre"
),
color = "white",
opacity = 0.5,
fillOpacity = 0.75,
weight = 1
) %>%
addLegend(
pal = absolute_pal,
value = c(-500,600),
title = "Absolute Change <br> in Density"
)

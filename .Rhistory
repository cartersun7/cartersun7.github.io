) %>%
right_join(
bay_multiple_tract
) %>%
arrange(match) %>%
.[1:21, ] %>%
left_join(bay_tracts %>% select(tract = GEOID)) %>%
st_as_sf()
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = match_set_tract[1, ],
color = "red"
) %>%
addPolygons(
data = match_set_tract[-1, ]
)
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(censusapi)
library(leaflet)
library(StatMatch)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
bay_pumas <-
ca_pumas %>%
st_centroid() %>%
.[bay_counties, ] %>%
st_drop_geometry() %>%
left_join(ca_pumas %>% select(GEOID10)) %>%
st_as_sf()
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = bay_pumas,
weight = 1,
color = "gray",
label = ~PUMACE10
) %>%
addMarkers(
lng = -121.9415017,
lat = 37.502171
) %>%
addPolygons(
data = bay_pumas %>%
filter(PUMACE10 == "08504")
)
pums_2014_2019 <-
2014:2019 %>%
map_dfr(function(year){
getCensus(
name = "acs/acs1/pums",
vintage = year,
region = "public use microdata area:*",
regionin = "state:06",
vars = c(
"SERIALNO",
"SPORDER",
ifelse(
year == 2019,
"JWTRNS",
"JWTR"
),
"PWGTP",
paste0("PWGTP",1:80)
)
) %>%
mutate(
year = year,
PUMA = public_use_microdata_area %>% str_pad(5,"left","0")
) %>%
filter(
PUMA %in% bay_pumas$PUMACE10
) %>%
rename(
JWTR = ifelse(
year == 2019,
"JWTRNS",
"JWTR"
)
)
})
pums_bart <- pums_2014_2019 %>%
mutate(
PWGTP = as.numeric(PWGTP),
bart = ifelse(
JWTR %in% c("4"),
PWGTP,
0
)
) %>%
group_by(PUMA, year) %>%
summarize(
pop = sum(PWGTP),
bart = sum(bart)
)
pums_2014_2019 <-
2014:2019 %>%
map_dfr(function(year){
getCensus(
name = "acs/acs1/pums",
vintage = year,
region = "public use microdata area:*",
regionin = "state:06",
vars = c(
"SERIALNO",
"SPORDER",
ifelse(
year == 2019,
"JWTRNS",
"JWTR"
),
"PWGTP",
paste0("PWGTP",1:80)
)
) %>%
mutate(
year = year,
PUMA = public_use_microdata_area %>% str_pad(5,"left","0")
) %>%
filter(
PUMA %in% bay_pumas$PUMACE10
) %>%
rename(
JWTR = ifelse(
year == 2019,
"JWTRNS",
"JWTR"
)
)
})
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(censusapi)
library(leaflet)
library(StatMatch)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
bay_pumas <-
ca_pumas %>%
st_centroid() %>%
.[bay_counties, ] %>%
st_drop_geometry() %>%
left_join(ca_pumas %>% select(GEOID10)) %>%
st_as_sf()
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = bay_pumas,
weight = 1,
color = "gray",
label = ~PUMACE10
) %>%
addMarkers(
lng = -121.9415017,
lat = 37.502171
) %>%
addPolygons(
data = bay_pumas %>%
filter(PUMACE10 == "08504")
))
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(censusapi)
library(leaflet)
library(StatMatch)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
bay_pumas <-
ca_pumas %>%
st_centroid() %>%
.[bay_counties, ] %>%
st_drop_geometry() %>%
left_join(ca_pumas %>% select(GEOID10)) %>%
st_as_sf()
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = bay_pumas,
weight = 1,
color = "gray",
label = ~PUMACE10
) %>%
addMarkers(
lng = -121.9415017,
lat = 37.502171
) %>%
addPolygons(
data = bay_pumas %>%
filter(PUMACE10 == "08504")
)
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(censusapi)
library(leaflet)
library(StatMatch)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
bay_pumas <-
ca_pumas %>%
st_centroid() %>%
.[bay_counties, ] %>%
st_drop_geometry() %>%
left_join(ca_pumas %>% select(GEOID10)) %>%
st_as_sf()
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addPolygons(
data = bay_pumas,
weight = 1,
color = "gray",
label = ~PUMACE10
) %>%
addMarkers(
lng = -121.9415017,
lat = 37.502171
) %>%
addPolygons(
data = bay_pumas %>%
filter(PUMACE10 == "08504")
)
pums_2014_2019 <-
2014:2019 %>%
map_dfr(function(year){
getCensus(
name = "acs/acs1/pums",
vintage = year,
region = "public use microdata area:*",
regionin = "state:06",
vars = c(
"SERIALNO",
"SPORDER",
ifelse(
year == 2019,
"JWTRNS",
"JWTR"
),
"PWGTP",
paste0("PWGTP",1:80)
)
) %>%
mutate(
year = year,
PUMA = public_use_microdata_area %>% str_pad(5,"left","0")
) %>%
filter(
PUMA %in% bay_pumas$PUMACE10
) %>%
rename(
JWTR = ifelse(
year == 2019,
"JWTRNS",
"JWTR"
)
)
})
pums_bart <- pums_2014_2019 %>%
mutate(
PWGTP = as.numeric(PWGTP),
bart = ifelse(
JWTR %in% c("4"),
PWGTP,
0
)
) %>%
group_by(PUMA, year) %>%
summarize(
pop = sum(PWGTP),
bart = sum(bart)
)
View(acs_vars_2019_5yr)
knitr::opts_chunk$set(include = TRUE)
library(censusapi)
library(tidyverse)
library(tigris)
library(sf)
library(leaflet)
Sys.setenv(CENSUS_KEY="ae50ac1baf05a1c9f156a1c83c62722ac7838e04")
temp <- tempfile()
download.file("https://www2.census.gov/programs-surveys/acs/data/pums/2019/1-Year/csv_hca.zip",destfile = temp)
pums_hca_2019_1yr <- read_csv(unzip(temp,"psam_h06.csv"))
unlink(temp)
pums_2019_1yr <- getCensus(
name = "acs/acs1/pums",
vintage = 2019,
region = "public use microdata area:*",
regionin = "state:06",
vars = c(
"SERIALNO",
"SPORDER",
"PWGTP",
"WGTP",
"NP",
"HHL",
"HINCP",
"TEN",
"HUPAC",
"R65"
)
)
View(pums_hca_2019_1yr)
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
pums_2019_1yr <- getCensus(
name = "acs/acs1/pums",
vintage = 2019,
region = "public use microdata area:*",
regionin = "state:06",
vars = c(
"SERIALNO",
"SPORDER",
"PWGTP",
"WGTP",
"NP",
"HHL",
"HINCP",
"LANX"
)
)
pums_2019_1yr <- getCensus(
name = "acs/acs1/pums",
vintage = 2019,
region = "public use microdata area:*",
regionin = "state:06",
vars = c(
"SERIALNO",
"SPORDER",
"PWGTP",
"WGTP",
"NP",
"HHL",
"HINCP",
"LANX"
)
)
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
ca_counties <- counties("CA", cb = T, progress_bar = F)
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
library(censusapi)
library(tidyverse)
library(tigris)
library(sf)
library(leaflet)
Sys.setenv(CENSUS_KEY="ae50ac1baf05a1c9f156a1c83c62722ac7838e04")
temp <- tempfile()
download.file("https://www2.census.gov/programs-surveys/acs/data/pums/2019/1-Year/csv_hca.zip",destfile = temp)
pums_hca_2019_1yr <- read_csv(unzip(temp,"psam_h06.csv"))
unlink(temp)
ca_pumas <-
pumas("CA", cb = T, progress_bar = F)
bay_county_names <-
c(
"Alameda",
"Contra Costa",
"Marin",
"Napa",
"San Francisco",
"San Mateo",
"Santa Clara",
"Solano",
"Sonoma"
)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
bay_counties <-
counties("CA", cb = T, progress_bar = F) %>%
filter(NAME %in% bay_county_names)
bay_pumas <-
ca_pumas %>%
st_centroid() %>%
.[bay_counties, ] %>%
st_drop_geometry() %>%
left_join(ca_pumas %>% select(GEOID10)) %>%
st_as_sf()
knitr::opts_chunk$set(echo = F, warnings = F, messages = F)
ca_counties <- counties("CA", cb = T, progress_bar = F)
setwd("~/Documents/GitHub/cartersun7.github.io")
ca_counties <- counties("CA", cb = T, progress_bar = F)
library(tigris)
library(tidyverse)
library(tidycensus)
library(sf)
library(censusapi)
library(leaflet)
library(StatMatch)
Sys.setenv(CENSUS_KEY="ae50ac1baf05a1c9f156a1c83c62722ac7838e04")
ca_counties <- counties("CA", cb = T, progress_bar = F)
